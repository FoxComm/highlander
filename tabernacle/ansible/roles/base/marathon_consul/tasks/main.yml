---

- name: Add Marathon consul apt key
  apt_key: url={{marathon_consul_apt_key_url}}

- name: Add Marathon consul repository
  apt_repository: repo='deb {{marathon_consul_apt_url}} /' state=present update_cache=yes

- name: Install marathon-consul
  apt: name=marathon-consul state=latest force=yes

- name: Install marathon consul config
  template: src="config.json" dest={{marathon_consul_config_path}}

- name: Start marathon-consul
  systemd:
    state: restarted
    enabled: yes
    daemon_reload: yes
    name: marathon-consul

- name: Subscribe marathon events to marathon-consul
  command: curl -X POST 'http://marathon.service.consul:8080/v2/eventSubscriptions?callbackUrl=http://marathon-consul.service.consul:4000/events'
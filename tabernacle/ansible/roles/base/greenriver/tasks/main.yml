---

- name: Copy Jar
  copy: src={{greenriver_jar_src}} dest={{greenriver_jar}} mode="u+x,g+x,o+x"
  sudo: true

- name: Copy Mapping Command
  template: src=create_es_mappings.sh dest=/usr/local/bin/create_es_mappings.sh mode="u+x,g+x,o+x"
  sudo: true

- name: Copy Service
  template: src=greenriver.service dest="{{dest_services}}/greenriver.service"
  sudo: true

- name: Reload Systemd for Greenriver
  sudo: yes
  command: systemctl daemon-reload

- name: Restart Greenriver
  service: name=greenriver state=restarted enabled=yes
  sudo: true

- name: Copy Greenriver Consul Health Checks
  template: src=greenriver.json dest="/etc/consul.d/greenriver.json"
  sudo: true
  notify: reload consul

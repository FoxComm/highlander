---

- name: Disable Mesos Consul
  systemd:
    state: stopped
    enabled: no
    daemon_reload: yes
    name: mesos_consul
  when: stop_mesos_consul is defined and stop_mesos_consul

- name: Remove "marathon" tag in consul for marathon
  template: src=../../../base/mesos_master/templates/marathon.json dest=/etc/consul.d/marathon.json
  notify: reload consul

- name: Restart consul_agent
  systemd:
      name: consul_agent
      state: restarted

- name: Add event subscribtion support for marathon
  template: src=../../../base/mesos_master/templates/run_marathon.sh dest=/usr/local/bin mode="u+x,g+x,o+x"

- name: Restart marathon
  service: name={{item}} state=restarted
  with_items:
    - marathon
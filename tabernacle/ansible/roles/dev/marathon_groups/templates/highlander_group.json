{
    "id": "/highlander",
    "groups": [
        {
            "id": "ic-storage",
            "apps": [
                {
                    "id": "henhouse",
                    "cmd": null,
                    "cpus": 1,
                    "mem": 500,
                    "disk": 0,
                    "instances": 1,
                    "maxLaunchDelaySeconds": 10,
                    "labels": {
                        "LAYER": "backend",
                        "LANG": "cpp",
                        "TAG": "{{docker_tags.henhouse}}",
                        "consul": "henhouse"
                    },
                    "container": {
                        "type": "DOCKER",
                        "volumes": [{
                            "containerPath": "hendata",
                            "mode": "RW",
                            "persistent": {
                                "type": "root",
                                "size": 1000,
                                "constraints": []
                            }
                        }],
                        "docker": {
                            "image": "{{docker_registry}}:5000/henhouse:{{docker_tags.henhouse}}",
                            "network": "HOST",
                            "privileged": false,
                            "parameters": [],
                            "forcePullImage": true
                        }
                    },
                    "residency": {
                        "taskLostBehavior": "WAIT_FOREVER"
                    },
                    "env": {
                        "DATA": "/var/lib/sandbox/hendata"
                    },
                    "healthChecks": [{
                        "path": "/summary?keys=ping",
                        "protocol": "HTTP",
                        "portIndex": 0,
                        "gracePeriodSeconds": 300,
                        "intervalSeconds": 60,
                        "timeoutSeconds": 20,
                        "maxConsecutiveFailures": 3,
                        "ignoreHttp1xx": false
                    }],
                    "portDefinitions": [{
                        "port": 9999,
                        "protocol": "tcp",
                        "labels": {}
                    }]
                },
                {
                    "id": "neo4j",
                    "cmd": null,
                    "cpus": 1,
                    "mem": 2048,
                    "disk": 0,
                    "instances": 1,
                    "maxLaunchDelaySeconds": 10,
                    "labels": {
                        "LAYER": "backend",
                        "consul": "neo4j"
                    },
                    "container": {
                        "type": "DOCKER",
                        "volumes": [{
                                "containerPath": "data",
                                "mode": "RW",
                                "persistent": {
                                    "size": 1048
                                }
                            },
                            {
                                "containerPath": "logs",
                                "mode": "RW",
                                "persistent": {
                                    "size": 1048
                                }
                            },
                            {
                                "containerPath": "/data",
                                "hostPath": "data",
                                "mode": "RW"
                            },
                            {
                                "containerPath": "/logs",
                                "hostPath": "logs",
                                "mode": "RW"
                            }
                        ],
                        "docker": {
                            "image": "neo4j:3.0",
                            "network": "HOST",
                            "portMappings": null,
                            "privileged": false,
                            "parameters": [],
                            "forcePullImage": false
                        }
                    },
                    "portDefinitions": [{
                        "port": 10011,
                        "protocol": "tcp",
                        "labels": {}
                    }],
                    "healthChecks": [{
                        "gracePeriodSeconds": 300,
                        "intervalSeconds": 30,
                        "timeoutSeconds": 20,
                        "maxConsecutiveFailures": 3,
                        "port": 7474,
                        "path": "/",
                        "protocol": "HTTP",
                        "ignoreHttp1xx": false
                    }],
                    "upgradeStrategy": {
                        "minimumHealthCapacity": 0.5,
                        "maximumOverCapacity": 0
                    }
                }
            ]
        },
        {
            "id": "backend",
            "dependencies": ["/highlander/ic-storage"],
            "apps": [
                {
                    "id": "phoenix",
                    "cmd": null,
                    "cpus": 1,
                    "mem": 4096,
                    "disk": 0,
                    "instances": 1,
                    "maxLaunchDelaySeconds": 10,
                    "labels": {
                        "LAYER": "backend",
                        "LANG": "scala",
                        "consul": "phoenix",
                        "TAG": "{{docker_tags.phoenix}}"
                    },
                    "env": {
                        "PORT": "{{phoenix_port}}",
                        "SCHEMA_REGISTRY_URL": "http://{{schema_server}}",
                        "KAFKA_BROKER": "{{kafka_server}}",
                        "PHOENIX_PUBLIC_KEY": "/keys/public_key.der",
                        "PHOENIX_PRIVATE_KEY": "/keys/private_key.der",
                        "PHOENIX_COOKIE_SECURE": "off",
                        "PHOENIX_AUTH_METHOD": "jwt",
                        "SEARCH_SERVER": "elasticsearch://{{search_server}}",
                        "GOOGLE_OAUTH_ADMIN_CLIENT_ID": "{{google_oauth_admin_client_id}}",
                        "GOOGLE_OAUTH_ADMIN_CLIENT_SECRET": "{{google_oauth_admin_secret}}",
                        "GOOGLE_OAUTH_ADMIN_REDIRECT_URI": "{{google_oauth_admin_redirect_uri}}",
                        "GOOGLE_OAUTH_ADMIN_HOSTED_DOMAIN": "{{google_oauth_admin_hosted_domain}}",
                        "GOOGLE_OAUTH_CUSTOMER_CLIENT_ID": "{{google_oauth_frontend_client_id}}",
                        "GOOGLE_OAUTH_CUSTOMER_CLIENT_SECRET": "{{google_oauth_frontend_secret}}",
                        "GOOGLE_OAUTH_CUSTOMER_REDIRECT_URI": "{{google_oauth_frontend_redirect_uri}}",
                        "AWS_ACCESS_KEY": "{{secret_key}}",
                        "AWS_SECRET_KEY": "{{secret_access_key}}",
                        "S3_BUCKET": "{{s3_bucket}}",
                        "S3_REGION": "{{s3_region}}",
                        "STRIPE_API_KEY": "{{stripe_api_key}}",
                        "MIDDLEWAREHOUSE_URL": "http://{{middlewarehouse_server}}",
                        "TAX_RULE_REGION": "{{phoenix_tax_rule_region}}",
                        "TAX_RULE_RATE": "{{phoenix_tax_rule_rate}}",
                        "JAVA_OPTS": "{% if jmx_enabled %}-Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.port={{phoenix_jmx_port}} -Dcom.sun.management.jmxremote.local.only=false -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false{% endif %} -Dphoenix.env={{phoenix_env}} -Dhttp.interface=0.0.0.0 -Ddb.host={{db_host}} -Ddb.url=jdbc:postgresql://{{db_host}}/{{db_name}}?user={{db_user}} -Ddb.name={{db_name}} -Dakka.tracing.host={{zipkin_collector}} -Dakka.tracing.enabled={{phoenix_tracing}} -Dauth.tokenTTL={{phoenix_token_ttl}}"
                    },
                    "ports": [{{phoenix_port}}],
                    "healthChecks": [{
                        "path": "/v1/public/ping",
                        "protocol": "HTTP",
                        "gracePeriodSeconds": 300,
                        "intervalSeconds": 30,
                        "timeoutSeconds": 20,
                        "maxConsecutiveFailures": 3,
                        "ignoreHttp1xx": false,
                        "port": {{phoenix_port}}
                    }],
                    "constraints": [
                        ["hostname", "UNIQUE"]
                    ],
                    "container": {
                        "type": "DOCKER",
                        "volumes": [{
                                "containerPath": "/keys",
                                "hostPath": "{{public_keys_dest_dir}}",
                                "mode": "RO"
                            },
                            {
                                "containerPath": "{{docker_logs_dir}}",
                                "hostPath": "{{docker_logs_host_dir}}",
                                "mode": "RW"
                            }
                        ],
                        "docker": {
                            "image": "{{docker_registry}}:5000/phoenix:{{docker_tags.phoenix}}",
                            "network": "HOST",
                            "privileged": false,
                            "parameters": [],
                            "forcePullImage": true
                        }
                    }
                },
                {
                    "id": "isaac",
                    "cmd": null,
                    "cpus": 0.25,
                    "mem": 64,
                    "disk": 0,
                    "instances": 1,
                    "maxLaunchDelaySeconds": 10,
                    "labels": {
                        "LAYER": "backend",
                        "LANG": "cpp",
                        "consul": "isaac",
                        "TAG": "{{docker_tags.isaac}}"
                    },
                    "container": {
                        "type": "DOCKER",
                        "volumes": [{
                                "containerPath": "/certs",
                                "hostPath": "{{public_keys_dest_dir}}",
                                "mode": "RO"
                            },
                            {
                                "containerPath": "{{docker_logs_dir}}",
                                "hostPath": "{{docker_logs_host_dir}}",
                                "mode": "RW"
                            }
                        ],
                        "docker": {
                            "image": "{{docker_registry}}:5000/isaac:{{docker_tags.isaac}}",
                            "network": "HOST",
                            "privileged": false,
                            "parameters": [],
                            "forcePullImage": true
                        }
                    },
                    "env": {
                        "PUBLIC_KEY": "/certs/public_key.pem",
                        "DB_HOST": "{{docker_db_host}}",
                        "DB_NAME": "{{phoenix_db_name}}",
                        "DB_USER": "{{db_user}}"
                    },
                    "healthChecks": [{
                        "path": "/ping",
                        "protocol": "HTTP",
                        "portIndex": 0,
                        "gracePeriodSeconds": 300,
                        "intervalSeconds": 30,
                        "timeoutSeconds": 20,
                        "maxConsecutiveFailures": 3,
                        "ignoreHttp1xx": false
                    }],
                    "portDefinitions": [{
                        "port": 10000,
                        "protocol": "tcp",
                        "labels": {}
                    }]
                },
                {
                    "id": "solomon",
                    "cmd": null,
                    "cpus": 0.5,
                    "mem": 256,
                    "disk": 0,
                    "instances": 1,
                    "maxLaunchDelaySeconds": 10,
                    "labels": {
                        "LAYER": "backend",
                        "LANG": "elixir",
                        "consul": "solomon",
                        "TAG": "{{docker_tags.solomon}}"
                    },
                    "env": {
                        "PORT": "{{solomon_port}}",
                        "DB_USER": "{{db_user}}",
                        "DB_HOST": "{{docker_db_host}}",
                        "DB_NAME": "{{phoenix_db_name}}",
                        "DB_PASSWORD": "",
                        "PRIVATE_KEY": "{{private_keys_dest_dir}}/private_key.pem",
                        "PUBLIC_KEY": "{{public_keys_dest_dir}}/public_key.pem",
                        "TOKEN_TTL": "{{solomon_token_ttl}}",
                        "SOLOMON_SECRET": "{{solomon_secret_token}}"
                    },
                    "ports": [{{solomon_port}}],
                    "constraints": [
                        ["hostname", "UNIQUE"]
                    ],
                    "container": {
                        "type": "DOCKER",
                        "volumes": [{
                                "containerPath": "{{public_keys_dest_dir}}",
                                "hostPath": "{{public_keys_dest_dir}}",
                                "mode": "RO"
                            },
                            {
                                "containerPath": "{{docker_logs_dir}}",
                                "hostPath": "{{docker_logs_host_dir}}",
                                "mode": "RW"
                            }
                        ],
                        "docker": {
                            "image": "{{docker_registry}}:5000/solomon:{{docker_tags.solomon}}",
                            "network": "HOST",
                            "privileged": false,
                            "parameters": [],
                            "forcePullImage": true
                        }
                    },
                    "healthChecks": [{
                        "path": "/ping",
                        "protocol": "HTTP",
                        "gracePeriodSeconds": 300,
                        "intervalSeconds": 30,
                        "timeoutSeconds": 20,
                        "maxConsecutiveFailures": 3,
                        "ignoreHttp1xx": false,
                        "port": {{solomon_port}}
                    }]
                },
                {
                    "id": "middlewarehouse",
                    "cmd": null,
                    "cpus": 0.25,
                    "mem": 64,
                    "disk": 0,
                    "instances": 1,
                    "maxLaunchDelaySeconds": 10,
                    "labels": {
                        "LAYER": "backend",
                        "LANG": "go",
                        "consul": "middlewarehouse",
                        "TAG": "{{docker_tags.middlewarehouse}}"
                    },
                    "container": {
                        "type": "DOCKER",
                        "volumes": [{
                            "containerPath": "{{docker_logs_dir}}",
                            "hostPath": "{{docker_logs_host_dir}}",
                            "mode": "RW"
                        }],
                        "docker": {
                            "image": "{{docker_registry}}:5000/middlewarehouse:{{docker_tags.middlewarehouse}}",
                            "network": "HOST",
                            "privileged": false,
                            "parameters": [],
                            "forcePullImage": true
                        }
                    },
                    "ports": [{{middlewarehouse_port}}],
                    "env": {
                        "PORT": "{{middlewarehouse_port}}",
                        "DB_SSLMODE": "disable",
                        "SCHEMA_REGISTRY_URL": "http://{{schema_server}}",
                        "DB_NAME": "{{middlewarehouse_db_name}}",
                        "PHOENIX_URL": "http://{{phoenix_server}}",
                        "ZOOKEEPER_URL": "{{zookeeper_server}}",
                        "LOG_LEVEL": "info",
                        "DB_HOST": "{{docker_db_host}}",
                        "KAFKA_BROKER": "{{kafka_server}}",
                        "DB_USER": "middlewarehouse"
                    },
                    "constraints": [
                        ["hostname", "UNIQUE"]
                    ],
                    "healthChecks": [{
                        "path": "/v1/public/ping",
                        "protocol": "HTTP",
                        "gracePeriodSeconds": 300,
                        "intervalSeconds": 30,
                        "timeoutSeconds": 20,
                        "maxConsecutiveFailures": 3,
                        "ignoreHttp1xx": false,
                        "port": {{middlewarehouse_port}}
                    }]
                }
            ]
        },
        {
            "id": "frontend",
            "dependencies": ["/highlander/backend"],
            "apps": [
                {
                    "id": "ashes",
                    "cmd": null,
                    "cpus": 1,
                    "mem": 2048,
                    "disk": 0,
                    "instances": 1,
                    "maxLaunchDelaySeconds": 10,
                    "env": {
                        "NODE_ENV": "production",
                        "PHOENIX_PUBLIC_KEY": "/keys/public_key.pem",
                        "BEHIND_NGINX": "true",
                        "STRIPE_PUBLISHABLE_KEY": "{{stripe_publishable_key}}",
                        "GA_TRACKING_ID": "{{ashes_ga_tracking_id}}"
                    },
                    "labels": {
                        "LAYER": "frontend",
                        "LANG": "javascript",
                        "consul": "ashes",
                        "TAG": "{{docker_tags.ashes}}"
                    },
                    "healthChecks": [{
                        "path": "/admin/login",
                        "protocol": "HTTP",
                        "gracePeriodSeconds": 300,
                        "intervalSeconds": 30,
                        "timeoutSeconds": 20,
                        "maxConsecutiveFailures": 3,
                        "ignoreHttp1xx": false,
                        "portIndex": 0
                    }],
                    "container": {
                        "type": "DOCKER",
                        "volumes": [{
                                "containerPath": "/keys",
                                "hostPath": "{{public_keys_dest_dir}}",
                                "mode": "RO"
                            },
                            {
                                "containerPath": "{{docker_logs_dir}}",
                                "hostPath": "{{docker_logs_host_dir}}",
                                "mode": "RW"
                            }
                        ],
                        "docker": {
                            "image": "{{docker_registry}}:5000/ashes:{{docker_tags.ashes}}",
                            "network": "HOST",
                            "privileged": false,
                            "parameters": [],
                            "forcePullImage": true
                        }
                    }
                },
                {
                    "id": "peacock",
                    "cmd": null,
                    "cpus": 1,
                    "mem": 1024,
                    "disk": 0,
                    "instances": 1,
                    "maxLaunchDelaySeconds": 10,
                    "labels": {
                        "LAYER": "frontend",
                        "LANG": "js",
                        "consul": "peacock",
                        "TAG": "{{docker_tags.peacock}}"
                    },
                    "env": {
                        "API_URL": "https://{{storefront_server_name}}",
                        "NODE_ENV": "production",
                        "PHOENIX_PUBLIC_KEY": "/keys/public_key.pem",
                        "STRIPE_PUBLISHABLE_KEY": "{{stripe_publishable_key}}",
                        "MAILCHIMP_API_KEY": "{{mailchimp_api_key}}",
                        "CONTACT_EMAIL": "{{contact_email}}",
                        "GA_TRACKING_ID": "{{ga_tracking_id}}",
                        "IMGIX_PRODUCTS_SOURCE": "{{imgix_products_source}}",
                        "S3_BUCKET_NAME": "{{imgix_s3_bucket_name}}",
                        "S3_BUCKET_PREFIX": "{{imgix_s3_bucket_prefix}}"
                    },
                    "healthChecks": [{
                        "path": "/",
                        "protocol": "HTTP",
                        "gracePeriodSeconds": 300,
                        "intervalSeconds": 30,
                        "timeoutSeconds": 20,
                        "maxConsecutiveFailures": 3,
                        "ignoreHttp1xx": false,
                        "portIndex": 0
                    }],
                    "container": {
                        "type": "DOCKER",
                        "volumes": [{
                                "containerPath": "/keys",
                                "hostPath": "{{public_keys_dest_dir}}",
                                "mode": "RO"
                            },
                            {
                                "containerPath": "{{docker_logs_dir}}",
                                "hostPath": "{{docker_logs_host_dir}}",
                                "mode": "RW"
                            }
                        ],
                        "docker": {
                            "image": "{{docker_registry}}:5000/peacock:{{docker_tags.peacock}}",
                            "network": "HOST",
                            "privileged": false,
                            "parameters": [],
                            "forcePullImage": true
                        }
                    }
                }
            ]
        },
        {
            "id": "consumers-layer-one",
            "dependencies": ["/highlander/frontend"],
            "apps": [
                {
                    "id": "green-river",
                    "cmd": null,
                    "cpus": 1,
                    "mem": 2048,
                    "disk": 0,
                    "instances": 1,
                    "maxLaunchDelaySeconds": 10,
                    "labels": {
                        "LAYER": "consumer",
                        "LANG": "scala",
                        "TAG": "{{docker_tags.greenriver}}",
                        "consul": "green-river"
                    },
                    "env": {
                        "JAVA_OPTS": "-Denv={{greenriver_env}} -D{{greenriver_env}}.kafka.broker={{kafka_server}} -D{{greenriver_env}}.elastic.host=elasticsearch://{{search_server}} -D{{greenriver_env}}.activity.phoenix.url=http://{{phoenix_server}}/v1 -D{{greenriver_env}}.avro.schemaRegistryUrl=http://{{schema_server}} -D{{greenriver_env}}.consume.restart={{greenriver_restart}} {% if jmx_enabled %}-Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.port={{greenriver_jmx_port}} -Dcom.sun.management.jmxremote.local.only=false -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false{% endif %}"
                    },
                    "container": {
                        "type": "DOCKER",
                        "docker": {
                            "image": "{{docker_registry}}:5000/greenriver:{{docker_tags.greenriver}}",
                            "network": "HOST",
                            "privileged": false,
                            "parameters": [],
                            "forcePullImage": true
                        },
                        "volumes": [{
                            "containerPath": "{{docker_logs_dir}}",
                            "hostPath": "{{docker_logs_host_dir}}",
                            "mode": "RW"
                        }]
                    },
                    "portDefinitions": [{
                        "port": 10003,
                        "protocol": "tcp",
                        "labels": {}
                    }],
                    "healthChecks": [{
                        "protocol": "COMMAND",
                        "command": {
                            "value": "ps -ef | grep -v grep | grep green-river-assembly-1.0.jar"
                        },
                        "gracePeriodSeconds": 300,
                        "intervalSeconds": 20,
                        "timeoutSeconds": 20,
                        "maxConsecutiveFailures": 3
                    }]
                },
                {
                    "id": "messaging",
                    "cmd": null,
                    "cpus": 1,
                    "mem": 512,
                    "disk": 0,
                    "instances": 1,
                    "maxLaunchDelaySeconds": 10,
                    "labels": {
                        "LAYER": "consumer",
                        "LANG": "clojure",
                        "TAG": "{{docker_tags.messaging}}",
                        "consul": "messaging"
                    },
                    "container": {
                        "type": "DOCKER",
                        "volumes": [{
                            "containerPath": "{{docker_logs_dir}}",
                            "hostPath": "{{docker_logs_host_dir}}",
                            "mode": "RW"
                        }],
                        "docker": {
                            "image": "{{docker_registry}}:5000/messaging:{{docker_tags.messaging}}",
                            "network": "HOST",
                            "privileged": false,
                            "parameters": [],
                            "forcePullImage": true
                        }
                    },
                    "env": {
                        "PHOENIX_USER": "{{phoenix_api_user}}",
                        "PHOENIX_PASSWORD": "{{phoenix_api_password}}",
                        "PHOENIX_URL": "http://{{phoenix_server}}",
                        "API_HOST": "{{messaging_host}}",
                        "KAFKA_BROKER": "{{kafka_server}}",
                        "SCHEMA_REGISTRY_URL": "http://{{schema_server}}",
                        "JAVA_OPTS": "{% if jmx_enabled %}-Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.port={{messaging_jmx_port}} -Dcom.sun.management.jmxremote.local.only=false -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false{% endif %}"
                    },
                    "healthChecks": [{
                        "protocol": "COMMAND",
                        "command": {
                            "value": "ps -ef | grep -v grep | grep messaging.jar"
                        },
                        "gracePeriodSeconds": 300,
                        "intervalSeconds": 30,
                        "timeoutSeconds": 20,
                        "maxConsecutiveFailures": 3
                    }]
                }
            ]
        },
        {
            "id": "consumers-layer-two",
            "dependencies": ["/highlander/consumers-layer-one"],
            "apps": [
                {
                    "id": "capture-consumer",
                    "cmd": null,
                    "cpus": 0.25,
                    "mem": 64,
                    "disk": 0,
                    "instances": 1,
                    "maxLaunchDelaySeconds": 10,
                    "labels": {
                        "LAYER": "consumer",
                        "LANG": "go",
                        "TAG": "{{docker_tags.capture_consumer}}",
                        "consul": "capture-consumer"
                    },
                    "container": {
                        "type": "DOCKER",
                        "volumes": [{
                            "containerPath": "{{docker_logs_dir}}",
                            "hostPath": "{{docker_logs_host_dir}}",
                            "mode": "RW"
                        }],
                        "docker": {
                            "image": "{{docker_registry}}:5000/capture-consumer:{{docker_tags.capture_consumer}}",
                            "network": "HOST",
                            "privileged": false,
                            "parameters": [],
                            "forcePullImage": true
                        }
                    },
                    "env": {
                        "TOPIC": "{{activities_topic}}",
                        "SCHEMA_REPOSITORY_URL": "http://{{schema_server}}",
                        "ZOOKEEPER_URL": "{{zookeeper_server}}",
                        "MWH_URL": "http://{{middlewarehouse_server}}",
                        "PHOENIX_URL": "http://{{phoenix_server}}",
                        "PHOENIX_USER": "{{phoenix_api_user}}",
                        "PHOENIX_PASSWORD": "{{phoenix_api_password}}"
                    },
                    "healthChecks": [{
                        "protocol": "COMMAND",
                        "command": {
                            "value": "ps -ef | grep -v grep | grep capture-consumer"
                        },
                        "gracePeriodSeconds": 300,
                        "intervalSeconds": 30,
                        "timeoutSeconds": 20,
                        "maxConsecutiveFailures": 3,
                        "ignoreHttp1xx": false
                    }]
                },
                {
                    "id": "customer-groups-consumer",
                    "cmd": null,
                    "cpus": 0.25,
                    "mem": 64,
                    "disk": 0,
                    "instances": 1,
                    "maxLaunchDelaySeconds": 10,
                    "labels": {
                        "LAYER": "consumer",
                        "LANG": "go",
                        "TAG": "{{docker_tags.customer_groups_consumer}}",
                        "consul": "customer-groups-consumer"
                    },
                    "container": {
                        "type": "DOCKER",
                        "volumes": [{
                            "containerPath": "{{docker_logs_dir}}",
                            "hostPath": "{{docker_logs_host_dir}}",
                            "mode": "RW"
                        }],
                        "docker": {
                            "image": "{{docker_registry}}:5000/customer-groups-consumer:{{docker_tags.customer_groups_consumer}}",
                            "network": "HOST",
                            "privileged": false,
                            "parameters": [],
                            "forcePullImage": true
                        }
                    },
                    "env": {
                        "ELASTIC_URL": "http://{{search_server_http}}",
                        "PHOENIX_URL": "http://{{phoenix_server}}",
                        "PHOENIX_USER": "{{phoenix_api_user}}",
                        "PHOENIX_PASSWORD": "{{phoenix_api_password}}",
                        "POLLING_INTERVAL": "1m",
                        "TOPIC": "{{activities_topic}}",
                        "SCHEMA_REPOSITORY_URL": "http://{{schema_server}}",
                        "ZOOKEEPER_URL": "{{zookeeper_server}}",
                        "MWH_URL": "http://{{middlewarehouse_server}}"
                    },
                    "healthChecks": [{
                        "protocol": "COMMAND",
                        "command": {
                            "value": "ps -ef | grep -v grep | grep customer-groups-consumer"
                        },
                        "gracePeriodSeconds": 300,
                        "intervalSeconds": 30,
                        "timeoutSeconds": 20,
                        "maxConsecutiveFailures": 3
                    }]
                },
                {
                    "id": "gift-card-consumer",
                    "cmd": null,
                    "cpus": 0.25,
                    "mem": 64,
                    "disk": 0,
                    "instances": 1,
                    "maxLaunchDelaySeconds": 10,
                    "labels": {
                        "LAYER": "consumer",
                        "LANG": "go",
                        "TAG": "{{docker_tags.gift_card_consumer}}",
                        "consul": "gift-card-consumer"
                    },
                    "container": {
                        "type": "DOCKER",
                        "volumes": [{
                            "containerPath": "{{docker_logs_dir}}",
                            "hostPath": "{{docker_logs_host_dir}}",
                            "mode": "RW"
                        }],
                        "docker": {
                            "image": "{{docker_registry}}:5000/gift-card-consumer:{{docker_tags.gift_card_consumer}}",
                            "network": "HOST",
                            "privileged": false,
                            "parameters": [],
                            "forcePullImage": true
                        }
                    },
                    "env": {
                        "TOPIC": "{{activities_topic}}",
                        "SCHEMA_REPOSITORY_URL": "http://{{schema_server}}",
                        "ZOOKEEPER_URL": "{{zookeeper_server}}",
                        "MWH_URL": "http://{{middlewarehouse_server}}",
                        "PHOENIX_URL": "http://{{phoenix_server}}",
                        "PHOENIX_USER": "{{phoenix_api_user}}",
                        "PHOENIX_PASSWORD": "{{phoenix_api_password}}"
                    },
                    "healthChecks": [{
                        "protocol": "COMMAND",
                        "command": {
                            "value": "ps -ef | grep -v grep | grep gift-card-consumer"
                        },
                        "gracePeriodSeconds": 300,
                        "intervalSeconds": 30,
                        "timeoutSeconds": 20,
                        "maxConsecutiveFailures": 3,
                        "ignoreHttp1xx": false
                    }]
                },
                {
                    "id": "shipments-consumer",
                    "cmd": null,
                    "cpus": 0.25,
                    "mem": 64,
                    "disk": 0,
                    "instances": 1,
                    "maxLaunchDelaySeconds": 10,
                    "labels": {
                        "LAYER": "consumer",
                        "LANG": "go",
                        "TAG": "{{docker_tags.shipments_consumer}}",
                        "consul": "shipments-consumer"
                    },
                    "container": {
                        "type": "DOCKER",
                        "volumes": [{
                            "containerPath": "{{docker_logs_dir}}",
                            "hostPath": "{{docker_logs_host_dir}}",
                            "mode": "RW"
                        }],
                        "docker": {
                            "image": "{{docker_registry}}:5000/shipments-consumer:{{docker_tags.shipments_consumer}}",
                            "network": "HOST",
                            "privileged": false,
                            "parameters": [],
                            "forcePullImage": true
                        }
                    },
                    "env": {
                        "TOPIC": "{{activities_topic}}",
                        "SCHEMA_REPOSITORY_URL": "http://{{schema_server}}",
                        "ZOOKEEPER_URL": "{{zookeeper_server}}",
                        "MWH_URL": "http://{{middlewarehouse_server}}",
                        "PHOENIX_URL": "http://{{phoenix_server}}",
                        "PHOENIX_USER": "{{phoenix_api_user}}",
                        "PHOENIX_PASSWORD": "{{phoenix_api_password}}"
                    },
                    "healthChecks": [{
                        "protocol": "COMMAND",
                        "command": {
                            "value": "ps -ef | grep -v grep | grep shipments-consumer"
                        },
                        "gracePeriodSeconds": 300,
                        "intervalSeconds": 30,
                        "timeoutSeconds": 20,
                        "maxConsecutiveFailures": 3
                    }]
                },
                {
                    "id": "stock-items-consumer",
                    "cmd": null,
                    "cpus": 0.25,
                    "mem": 64,
                    "disk": 0,
                    "instances": 1,
                    "maxLaunchDelaySeconds": 10,
                    "labels": {
                        "LAYER": "consumer",
                        "LANG": "go",
                        "TAG": "{{docker_tags.stock_items_consumer}}",
                        "consul": "stock-items-consumer"
                    },
                    "container": {
                        "type": "DOCKER",
                        "volumes": [{
                            "containerPath": "{{docker_logs_dir}}",
                            "hostPath": "{{docker_logs_host_dir}}",
                            "mode": "RW"
                        }],
                        "docker": {
                            "image": "{{docker_registry}}:5000/stock-items-consumer:{{docker_tags.stock_items_consumer}}",
                            "network": "HOST",
                            "privileged": false,
                            "parameters": [],
                            "forcePullImage": true
                        }
                    },
                    "env": {
                        "TOPIC": "sku_search_view",
                        "SCHEMA_REPOSITORY_URL": "http://{{schema_server}}",
                        "ZOOKEEPER_URL": "{{zookeeper_server}}",
                        "MWH_URL": "http://{{middlewarehouse_server}}",
                        "PHOENIX_URL": "http://{{phoenix_server}}",
                        "PHOENIX_USER": "{{phoenix_api_user}}",
                        "PHOENIX_PASSWORD": "{{phoenix_api_password}}",
                        "OFFSET_RESET_STRATEGY": "smallest"
                    },
                    "healthChecks": [{
                        "protocol": "COMMAND",
                        "command": {
                            "value": "ps -ef | grep -v grep | grep stock-items-consumer"
                        },
                        "gracePeriodSeconds": 300,
                        "intervalSeconds": 30,
                        "timeoutSeconds": 20,
                        "maxConsecutiveFailures": 3
                    }]
                }
            ]
        },
        {
            "id": "ic-layer-one",
            "dependencies": ["/highlander/consumers-layer-two"],
            "apps": [
                {
                    "id": "bernardo",
                    "cmd": null,
                    "cpus": 0.25,
                    "mem": 64,
                    "disk": 0,
                    "instances": 1,
                    "maxLaunchDelaySeconds": 10,
                    "labels": {
                        "LAYER": "backend",
                        "LANG": "cpp",
                        "TAG": "{{docker_tags.bernardo}}",
                        "consul": "bernardo"
                    },
                    "container": {
                        "type": "DOCKER",
                        "volumes": [{
                            "containerPath": "{{docker_logs_dir}}",
                            "hostPath": "{{docker_logs_host_dir}}",
                            "mode": "RW"
                        }],
                        "docker": {
                            "image": "{{docker_registry}}:5000/bernardo:{{docker_tags.bernardo}}",
                            "network": "HOST",
                            "privileged": false,
                            "parameters": [],
                            "forcePullImage": true
                        }
                    },
                    "env": {
                        "DB_HOST": "{{docker_db_host}}",
                        "DB_NAME": "{{bernardo_db_name}}",
                        "DB_USER": "{{bernardo_db_user}}",
                        "PORT1": "19090"
                    },
                    "constraints": [
                        ["hostname", "UNIQUE"]
                    ],
                    "healthChecks": [{
                        "path": "/ping",
                        "protocol": "HTTP",
                        "portIndex": 0,
                        "gracePeriodSeconds": 300,
                        "intervalSeconds": 30,
                        "timeoutSeconds": 20,
                        "maxConsecutiveFailures": 3,
                        "ignoreHttp1xx": false
                    }],
                    "portDefinitions": [{
                        "port": 10000,
                        "protocol": "tcp",
                        "name": "http",
                        "labels": {}
                    }]
                }
            ]
        },
        {
            "id": "ic-layer-two",
            "dependencies": ["/highlander/ic-layer-one"],
            "apps": [
                {
                    "id": "river-rock",
                    "cmd": null,
                    "cpus": 0.25,
                    "mem": 64,
                    "disk": 0,
                    "instances": 1,
                    "maxLaunchDelaySeconds": 10,
                    "labels": {
                        "LAYER": "backend",
                        "LANG": "go",
                        "TAG": "{{docker_tags.river_rock}}",
                        "consul": "river-rock"
                    },
                    "container": {
                        "type": "DOCKER",
                        "docker": {
                            "image": "{{docker_registry}}:5000/river-rock:{{docker_tags.river_rock}}",
                            "network": "HOST",
                            "privileged": false,
                            "parameters": [],
                            "forcePullImage": true
                        },
                        "volumes": [{
                            "containerPath": "{{docker_logs_dir}}",
                            "hostPath": "{{docker_logs_host_dir}}",
                            "mode": "RW"
                        }]
                    },
                    "env": {
                        "DB_HOST": "{{docker_db_host}}",
                        "DB_NAME": "{{bernardo_db_name}}",
                        "DB_USER": "{{bernardo_db_user}}",
                        "BERNARDO_HOST": "{{bernardo_host}}",
                        "UPSTREAM_URL": "http://balancer.service.consul:8888"
                    },
                    "healthChecks": [{
                        "path": "/ping",
                        "protocol": "HTTP",
                        "portIndex": 0,
                        "gracePeriodSeconds": 300,
                        "intervalSeconds": 30,
                        "timeoutSeconds": 20,
                        "maxConsecutiveFailures": 3,
                        "ignoreHttp1xx": false
                    }],
                    "portDefinitions": [{
                        "port": 10000,
                        "protocol": "tcp",
                        "name": "http",
                        "labels": {}
                    }]
                },
                {
                    "id": "eggcrate",
                    "cmd": null,
                    "cpus": 0.25,
                    "mem": 64,
                    "disk": 0,
                    "instances": 1,
                    "maxLaunchDelaySeconds": 10,
                    "labels": {
                        "LAYER": "backend",
                        "LANG": "go",
                        "TAG": "{{docker_tags.eggcrate}}",
                        "consul": "eggcrate"
                    },
                    "container": {
                        "type": "DOCKER",
                        "docker": {
                            "image": "{{docker_registry}}:5000/eggcrate:{{docker_tags.eggcrate}}",
                            "network": "HOST",
                            "privileged": false,
                            "parameters": [],
                            "forcePullImage": true
                        },
                        "volumes": [{
                            "containerPath": "{{docker_logs_dir}}",
                            "hostPath": "{{docker_logs_host_dir}}",
                            "mode": "RW"
                        }]
                    },
                    "env": {
                        "API_URL": "http://{{henhouse_host}}"
                    },
                    "healthChecks": [{
                        "path": "/ping",
                        "protocol": "HTTP",
                        "portIndex": 0,
                        "gracePeriodSeconds": 300,
                        "intervalSeconds": 60,
                        "timeoutSeconds": 20,
                        "maxConsecutiveFailures": 3,
                        "ignoreHttp1xx": false
                    }],
                    "portDefinitions": [{
                        "port": 10020,
                        "protocol": "tcp",
                        "labels": {}
                    }]
                },
                {
                    "id": "orders-sphex",
                    "cmd": null,
                    "cpus": 0.25,
                    "mem": 64,
                    "disk": 0,
                    "instances": 1,
                    "maxLaunchDelaySeconds": 10,
                    "labels": {
                        "LAYER": "consumer",
                        "LANG": "go",
                        "TAG": "{{docker_tags.orders_sphex}}",
                        "consul": "orders-sphex"
                    },
                    "container": {
                        "type": "DOCKER",
                        "docker": {
                            "image": "{{docker_registry}}:5000/orders-sphex:{{docker_tags.orders_sphex}}",
                            "network": "HOST",
                            "privileged": false,
                            "parameters": [],
                            "forcePullImage": true
                        },
                        "volumes": [{
                            "containerPath": "{{docker_logs_dir}}",
                            "hostPath": "{{docker_logs_host_dir}}",
                            "mode": "RW"
                        }]
                    },
                    "env": {
                        "TOPIC": "{{activities_topic}}",
                        "SCHEMA_REPOSITORY_URL": "http://{{schema_server}}",
                        "ZOOKEEPER_URL": "{{zookeeper_server}}",
                        "MWH_URL": "http://{{middlewarehouse_server}}",
                        "HENHOUSE": "{{henhouse_server}}"
                    },
                    "healthChecks": [{
                        "protocol": "COMMAND",
                        "command": {
                            "value": "ps -ef | grep -v grep | grep orders-sphex"
                        },
                        "gracePeriodSeconds": 300,
                        "intervalSeconds": 30,
                        "timeoutSeconds": 20,
                        "maxConsecutiveFailures": 3,
                        "ignoreHttp1xx": false
                    }]
                },
                {
                    "id": "product-activity",
                    "cmd": null,
                    "cpus": 0.25,
                    "mem": 64,
                    "disk": 0,
                    "instances": 1,
                    "maxLaunchDelaySeconds": 10,
                    "labels": {
                        "LAYER": "consumer",
                        "LANG": "go",
                        "TAG": "{{docker_tags.product_activity}}",
                        "consul": "product-activity"
                    },
                    "container": {
                        "type": "DOCKER",
                        "docker": {
                            "image": "{{docker_registry}}:5000/product-activity:{{docker_tags.product_activity}}",
                            "network": "HOST",
                            "privileged": false,
                            "parameters": [],
                            "forcePullImage": true
                        },
                        "volumes": [{
                            "containerPath": "{{docker_logs_dir}}",
                            "hostPath": "{{docker_logs_host_dir}}",
                            "mode": "RW"
                        }]
                    },
                    "env": {
                        "ELASTIC_URL": "http://{{search_server_http}}",
                        "ELASTIC_INDEX": "admin_1",
                        "INTERVAL": "{{product_activity_interval}}",
                        "HENHOUSE": "{{henhouse_server}}",
                        "HENHOUSE_PORT": ""
                    },
                    "healthChecks": [{
                        "protocol": "COMMAND",
                        "command": {
                            "value": "ps -ef | grep -v grep | grep product-activity"
                        },
                        "gracePeriodSeconds": 300,
                        "intervalSeconds": 30,
                        "timeoutSeconds": 20,
                        "maxConsecutiveFailures": 3,
                        "ignoreHttp1xx": false
                    }]
                }
            ]
        }
    ]
}

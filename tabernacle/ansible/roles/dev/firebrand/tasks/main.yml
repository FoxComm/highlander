---

- name: Remove Firebrand Directory
  file: path={{firebrand_install_dir}} state=absent

- name: Add Firebrand Directory
  file: path={{firebrand_install_dir}} state=directory

- name: Untar Firebrand code
  become: no
  unarchive:
    src: '{{firebrand_source_package}}'
    dest: '{{firebrand_install_dir}}/'
  sudo: true

- name: Build Firebrand
  shell: NODE_ENV={{firebrand_env}} DEMO_USER={{demo_user}} DEMO_PASS={{demo_pass}} FIREBRAND_LANGUAGE={{firebrand_default_language}} gulp build
  args:
    chdir: "{{firebrand_install_dir}}"
  when: demo_user != ""

- name: Install Firebrand service entry
  sudo: true
  template:
    src: "{{role_path}}/../../base/firebrand/templates/firebrand.service.j2"
    dest: "{{dest_services}}/firebrand.service"

- name: Reload Systemd for Firebrand
  sudo: yes
  command: systemctl daemon-reload

- name: Install Firebrand Run script
  sudo: true
  template: src=../../../base/firebrand/templates/run_firebrand.sh.j2 dest="{{ firebrand_install_dir }}/run_firebrand.sh" mode="u=rwx,g=rwx,o=r"

- name: Restart Firebrand
  service: name=firebrand state=restarted
  sudo: true

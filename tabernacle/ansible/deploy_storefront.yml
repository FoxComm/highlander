---

- name: Deploy Storefront to Stage / Production
  hosts: localhost
  connection: local
  vars:
    user: "{{ ansible_user | default(lookup('env', 'USER')) }}"
    # Steps
    step_build: "{{ lookup('env', 'STEP_BUILD') | default(true, true) }}"
    step_deploy: "{{ lookup('env', 'STEP_DEPLOY') | default(false, true) }}"
    # Main
    git_repo: "{{ lookup('env', 'GIT_REPO') | default('git@github.com:FoxComm/top-drawer.git', true) }}"
    git_tag: "{{ lookup('env', 'GIT_TAG') | default('master', true) }}"
    docker_registry: "{{ lookup('env', 'DOCKER_REPO') | default('td-docker.foxcommerce.com:5000', true) }}"
    docker_tag: "{{ lookup('env', 'DOCKER_TAG') | default('dummy', true) }}"
    marathon_ip: "{{ lookup('env', 'MARATHON_IP') | default('10.0.0.19', true) }}"
    marathon_template_path: "{{ lookup('env', 'MARATHON_TEMPLATE_PATH') | default('ext/td/storefront/templates/storefront-top-drawer.json', true) }}"
    # Environment variables for Docker container
    storefront_server_name: "{{ lookup('env', 'API_URL') }}"
    contact_email: "{{ lookup('env', 'CONTACT_EMAIL') }}"
    stripe_publishable_key: "{{ lookup('env', 'STRIPE_PUBLISHABLE_KEY') }}"
    mailchimp_api_key: "{{ lookup('env', 'MAILCHIMP_API_KEY') }}"
    ga_tracking_id: "{{ lookup('env', 'GA_TRACKING_ID') }}"
    # Default overrides
    app_name: storefront
    docker_tags:
        storefront_td: "{{docker_tag}}"
        storefront_tpg: "{{docker_tag}}"
    marathon_server: "{{marathon_ip}}:8080"
  roles:
    - { role: prod/storefront }

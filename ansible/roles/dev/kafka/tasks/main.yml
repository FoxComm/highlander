---
- name: Kill Zookeeper if it is Running
  shell: systemctl stop zookeeper || true
  sudo: true

- name: Purge Zookeeper Data
  file: path=/var/lib/zookeeper state=absent
  sudo: true

- name: Kill Kafka if it is Running
  shell: systemctl stop kafka || true
  sudo: true

- name: Purge Kafka Queue
  file: path=/var/lib/kafka state=absent
  sudo: true

- name: Create Kafka dir
  file: path=/var/lib/kafka state=directory
  sudo: true

- name: Kafka and Zookeeper
  service: name={{ item }} state=started enabled=yes
  sudo: true
  with_items:
    - zookeeper
    - kafka
    - schema-registry

- name: Sleep
  shell: sleep 5

#https://github.com/confluentinc/bottledwater-pg/issues/1
- name:
  uri:
    url: http://localhost:8081/config
    method: "PUT"
    body: "{\"compatibility\": \"NONE\"}"
    HEADER_Content-Type: "application/vnd.schemaregistry.v1+json"
  retries: 3
  delay: 5

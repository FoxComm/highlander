---

- name: Copy Binary
  copy: src={{middlewarehouse_bin_src}} dest={{middlewarehouse_bin}} mode="u+x,g+x,o+x"
  sudo: true
  when: updating_mwh

- name: Copy stock-items-consumer Binary
  copy: src={{middlewarehouse_consumers_stock_items_consumer_bin_src}} dest={{middlewarehouse_consumers_stock_items_consumer_bin}} mode="u+x,g+x,o+x"
  sudo: true
  when: updating_mwh

- name: Synchronize middlewarehouse Sql
  synchronize: src="{{middlewarehouse_src}}/sql" dest="{{middlewarehouse_dir}}" delete=yes recursive=yes
  sudo: true
  when: updating_mwh

- name: Migrate middlewarehouse DB
  shell: sudo -u root FLYWAY_HOME={{flyway_dir}} {{flyway}} migrate
  args:
    chdir: "{{middlewarehouse_dir}}"
  when: updating_mwh

- name: Restart middlewarehouse
  service: name=middlewarehouse state=restarted enabled=yes
  sudo: true

- name: Restart stock-items-consumer
  service: name=middlewarehouse-stock-items-consumer state=restarted enabled=yes
  sudo: true

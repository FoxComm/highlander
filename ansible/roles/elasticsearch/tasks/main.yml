---

- name: Get ElasticSearch
  get_url: url=https://download.elastic.co/elasticsearch/elasticsearch/{{es_zip}} dest={{home}}/{{es_zip}}

- name: Unzip ElasticSearch
  unarchive: src={{home}}/{{es_zip}} dest={{usr_local}} copy=no
  sudo: true

- name: Copy Run Script
  copy: src=run_elasticsearch.sh dest={{usr_local}}
  sudo: true

- name: Copy ElasticSearch service
  template: src=elasticsearch.service dest={{dest_services}}/
  sudo: true

- name: Kill Elasticsearch if it is Running
  shell: systemctl stop elasticsearch || true
  sudo: true

- name: Purge Elasticsearch data
  file: path={{es_path}}/data state=absent
  sudo: true

- name: Create Elasticsearch subdirectories
  file: path={{es_path}}/{{item}} owner={{ansible_ssh_user}} state=directory
  sudo: true
  with_items:
    - logs
    - plugins

- name: Setup Service
  service: name=elasticsearch state=restarted enabled=yes sleep=5
  sudo: true
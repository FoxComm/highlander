---

- name: Install Passlib
  apt: name=python-passlib state=latest force=yes

- name: Install htpasswd
  apt: name=apache2-utils state=latest force=yes

- name: Setup Demo Password
  htpasswd: path=/etc/nginx/passwdfile name=demo password=Xv6yEcAz owner=root group=www-data mode=0640

- name: Add Auth to Nginx
  lineinfile:
      dest: /etc/nginx/sites-available/default
      regexp:  "auth_basic"
      insertafter: "server_name _;"
      line: "auth_basic \"Restricted\"; auth_basic_user_file /etc/nginx/passwdfile;"

- name: Restart Nginx
  service: name=nginx state=restarted

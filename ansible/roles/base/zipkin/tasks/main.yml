---

- name: Clone Zipkin
  git: repo=https://github.com/openzipkin/zipkin dest=/usr/local/lib/zipkin
  sudo: true

- name: Copy Zipkin Service Files
  template: src={{item}} dest={{dest_services}}/
  sudo: true
  with_items:
      - zipkin_query.service
      - zipkin_collector.service
      - zipkin_web.service

- name: Reload Systemd for Kafka Related Services
  sudo: yes
  command: systemctl daemon-reload

- name: Start Zipkin Services
  service: name={{item}} state=started enabled=yes
  sudo: true
  with_items:
      - zipkin_query
      - zipkin_collector
      - zipkin_web

- name: Copy Consul Service Files
  template: src={{item}} dest=/etc/consul.d/
  sudo: true
  with_items:
      - zipkin_query.json
      - zipkin_collector.json
      - zipkin_web.json

---

- name: Copy Execution File
  template: src=run_consul_agent.sh dest="/usr/local/bin/run_consul_agent.sh" mode="u+x,g+x,o+x"
  sudo: true

- name: Copy Service
  template: src=consul_agent.service dest="{{dest_services}}/consul_agent.service"
  sudo: true

- name: Copy Config
  template: src=agent.json dest="/etc/consul.d/agent.json"
  sudo: true

- name: Reload Systemd for Consul Server
  sudo: yes
  command: systemctl daemon-reload

- name: Restart Consul Server
  service: name=consul_agent state=restarted enabled=yes
  sudo: true


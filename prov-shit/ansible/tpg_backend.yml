---

- name: Provision TPG Backend
  hosts: '{{hostname}}'
  vars:
    user: '{{ansible_ssh_user}}'
    docker_branch: master
    docker_registry: docker-tpg.foxcommerce.com
    upload_phoenix_jar: true
    upload_greenriver_jar: true
    update_es_mappings: true
    download_flyway: false
    seeds_cmd: utils.seeds.Seeds seed --seedAdmins
    with_seeder: false
    with_mwh_seeder: false
    with_gatling_seeder: false
  vars_prompt:
    - name: "hostname"
      prompt: "Enter a hostname to update backend"
      default: "tpg-stage-backend"
      private: no
  roles:
    - { role: dev/kafka }
    - { role: dev/elasticsearch }
    - { role: dev/db }
    - { role: archive/phoenix, sudo: true }
    - { role: archive/greenriver, sudo: true }
    - { role: prod/db_migrate }
    - { role: archive/seeder }
    - { role: ext/tpg/db_hotfix }
    - { role: ext/tpg/shipping }

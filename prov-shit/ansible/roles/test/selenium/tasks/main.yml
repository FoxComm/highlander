---

- name: Add Chrome apt key
  apt_key: url=https://dl-ssl.google.com/linux/linux_signing_key.pub
  pause: seconds=5

- name: Add Chrome apt repository
  apt_repository: repo='{{ item }}' state=present update_cache=yes
  with_items:
    - deb http://dl.google.com/linux/chrome/deb/ stable main
  pause: seconds=5

- name: Install Chrome and dependencies
  apt: name={{ item }} force=yes state=latest
  with_items:
    - google-chrome-stable
    - xvfb
  pause: seconds=5

- name: Create Dirs for allure and chromedriver
  file: path={{home}}/{{item}} state=directory
  with_items:
    - allure
    - chromedriver

- name: Get Allure Test Report
  get_url: url=https://github.com/allure-framework/allure-core/releases/download/allure-core-1.4.23.HOTFIX1/allure-commandline.tar.gz dest={{home}}

- name: Unzip Allure
  unarchive: src={{home}}/allure-commandline.tar.gz dest={{home}}/allure copy=no

- name: Remove Allure archive
  file: path={{home}}/allure-commandline.tar.gz state=absent

- name: Allure Symbolic link
  file: src={{home}}/allure/bin/allure dest=/usr/local/bin/allure state=link
  pause: seconds=5

- name: Get Web Driver
  get_url: url=http://chromedriver.storage.googleapis.com/2.23/chromedriver_linux64.zip dest={{home}}

- name: Unzip Web Driver
  unarchive: src={{home}}/chromedriver_linux64.zip dest={{home}}/chromedriver copy=no

- name: Remove Web Driver archive
  file: path={{home}}/chromedriver_linux64.zip state=absent

- name: Web Driver Symbolic link
  file: src={{home}}/chromedriver/chromedriver dest=/usr/local/bin/chromedriver state=link
  pause: seconds=5

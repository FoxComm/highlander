---

- name: Get Marathon Alerts
  get_url: url={{marathon_alerts_url}} dest=/usr/local/bin/marathon-alerts
  sudo: true

- name: Make Consul Alerts Executable
  command: chmod +x /usr/local/bin/marathon-alerts
  sudo: true

- name: Copy Execution File
  template: src=run_marathon_alerts.sh dest=/usr/local/bin/run_marathon_alerts.sh mode="u+x,g+x,o+x"
  sudo: true

- name: Copy Service
  template: src=marathon_alerts.service dest="{{dest_services}}/marathon_alerts.service"
  sudo: true

- name: Reload Systemd for Marathon Alerts
  command: systemctl daemon-reload
  sudo: true

- name: Restart Marathon Alerts
  service: name=marathon_alerts state=restarted enabled=yes
  sudo: true

- name: Copy Marathon Service File
  template: src=marathon_alerts.json dest="/etc/consul.d/marathon_alerts.json"
  sudo: true
  notify: reload consul

---

- name: Set Proper Variables
  set_fact:
    private_ip: "{{ansible_default_ipv4.address}}"
    dns_record: "appliance-{{ansible_default_ipv4.address | replace(\".\", \"-\") }}"
    appliance_domain: "{{dns_record}}.{{foxcomm_domain}}"
    appliance_hostname: "{{appliance_domain}}"
    ashes_server_name: "{{appliance_domain}}"
    storefront_server_name: "{{appliance_domain}}"

- name: Register DNS Record for Appliance
  dnsimple:
    account_email: "{{dnsimple_email}}"
    account_api_token: "{{dnsimple_token}}"
    domain: "{{foxcomm_domain}}"
    record: "{{dns_record}}"
    value: "{{private_ip}}"
    type: A
    ttl: 3600
    state: present
  delegate_to: localhost
  when: not vagrant_destroy

---

- name: Download Kibana
  get_url: url={{kibana_download_url}} dest={{home}}/{{kibana_name}}.zip

- name: Unzip Kibana
  unarchive: src={{home}}/{{kibana_name}}.zip dest={{home}} copy=no

- name: Copy Kibana to Working Directory
  shell: mv {{home}}/{{kibana_name}}/* {{kibana_dir}}/

- name: Remove Kibana Archive
  file: path={{home}}/{{kibana_name}}.zip state=absent

- name: Copy Kibana Config
  template: src=kibana.yml.j2 dest={{kibana_dir}}/config/kibana.yml

- name: Copy Kibana service
  template: src=kibana.service.j2 dest={{dest_services}}/kibana.service

- name: Reload Systemd for Kibana
  command: systemctl daemon-reload

- name: Restart Kibana
  service: name=kibana state=restarted

- name: Copy Consul Service File
  template: src=kibana.json dest="/etc/consul.d/kibana.json"
  notify: reload consul

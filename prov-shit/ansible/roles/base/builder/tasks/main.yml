---

- name: Upload Agent install script
  copy: src="agent_core.sh" dest="{{home}}/agent_core.sh" mode=0755

- name: Execute agent setup
  shell: "{{home}}/agent_core.sh"

- name: Install Ansible
  include: ansible.yml

- name: Install Isaac Dependencies
  include: isaac.yml

- name: Install Terraform
  include: terraform.yml

- name: Install Vagrant
  include: vagrant.yml

- name: Restart Buildkite Agent
  command: systemctl restart buildkite-agent

- name: Make sure buildkite keys are available.
  file: path="/var/lib/buildkite-agent/.ssh/id_rsa" owner=buildkite-agent group=buildkite-agent mode="600"

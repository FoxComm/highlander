---

- name: Install gulp globally
  shell: npm install gulp -g
  sudo: true

- name: Install Boot for Clojure
  shell: 'bash -c "cd /usr/local/bin && curl -fsSLo boot https://github.com/boot-clj/boot-bin/releases/download/latest/boot.sh && chmod 755 boot"'
  sudo: true
  args:
      creates: "/usr/local/bin/boot"

- name: Install Flow
  sudo: true
  copy: src="flow" dest="/usr/local/bin/flow" mode="u=rwx,g=rwx,o=rx"

- name: Restart Buildkite Agent
  sudo: true
  command: systemctl restart buildkite-agent
  tags: buildkite

- name: Make sure buildkite keys are available.
  file: path="/var/lib/buildkite-agent/.ssh/id_rsa" owner=buildkite-agent group=buildkite-agent mode="600"
  sudo: true
  tags: buildkite

- name: Install Packages for Isaac
  apt: name={{ item }} state=latest force=yes
  sudo: true
  with_items:
    - cmake
    - libboost-all-dev
    - libbotan1.10-dev
    - libsnappy-dev
    - libpqxx-dev
  tags: isaac

- name: Get Proxygen
  git: repo=https://github.com/facebook/proxygen.git dest={{proxygen_install_dir}} version={{proxygen_version}} force=yes
  tags: isaac

- name: Get Folly
  git: repo=https://github.com/facebook/folly.git dest={{folly_install_dir}} version={{folly_version}} force=yes
  tags: isaac

- name: Get Wangle
  git: repo=https://github.com/facebook/wangle.git dest={{wangle_install_dir}} version={{wangle_version}} force=yes
  tags: isaac
 
- name: Remove `git checkout master` from Proxygen Build Script
  lineinfile: dest={{proxygen_install_dir}}/proxygen/deps.sh state=absent regexp="checkout master"
  tags: isaac

- name: Build Proxygen
  shell: ./deps.sh && ./reinstall.sh
  args:
    chdir: "{{proxygen_install_dir}}/proxygen"
  sudo: true
  tags: isaac

- name: Create GOPATH Directories
  file: path={{home}}/go state=directory
  tags: golang

- name: Create GOPATH Directories
  file: path={{home}}/go/src state=directory
  tags: golang

- name: Create GOPATH Directories
  file: path={{home}}/go/bin state=directory
  tags: golang

- name: Add Glide repository
  apt_repository: repo='ppa:masterminds/glide' update_cache=yes
  sudo: true
  tags: golang

- name: Install Glide
  apt: name={{ item }} state=latest force=yes
  sudo: true
  with_items:
    - glide
  tags: golang

- name: Install Package for Ansible Lint
  apt: name=libffi-dev state=latest force=yes
  sudo: true

- name: Install ansible-lint
  pip: name=ansible-lint
  sudo: true

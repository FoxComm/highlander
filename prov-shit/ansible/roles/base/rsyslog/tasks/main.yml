---

- name: Install Rsyslog
  apt: name={{item}} state=installed
  with_items:
    - rsyslog
    - rsyslog-elasticsearch

- name: Remove Old Omelsticsearch Configuration
  file: path=/etc/rsyslog.d/elastic-51.conf state=absent

- name: Install Base Rsyslog Config
  template: >
    src=rsyslog.conf.j2
    dest=/etc/rsyslog.conf
    owner=root
    group=root
    mode=0644

- name: Install File Data Forwarding Config
  template: >
    src=mesos.conf.j2
    dest=/etc/rsyslog.d/51-mesos.conf
    owner=root
    group=root
    mode=0644

- name: Install Omelasticsearch Rsyslog Config
  template: >
    src=elastic.conf.j2
    dest=/etc/rsyslog.d/52-elastic.conf
    owner=root
    group=root
    mode=0644

- name: Reload Systemd for Rsyslog
  command: systemctl daemon-reload

- name: Restart Rsyslog
  service: name=rsyslog state=restarted

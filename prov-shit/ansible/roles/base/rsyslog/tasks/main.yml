---

- name: Install rsyslog
  apt: name={{item}} state=installed
  with_items:
    - rsyslog
    - rsyslog-elasticsearch

- include: "{{playbook_dir}}/tasks/dpkg_lock_cleanup.yml"

- name: Install base rsyslog config
  template: >
    src=rsyslog.conf.j2
    dest=/etc/rsyslog.conf
    owner=root
    group=root
    mode=0644

- name: Install rsyslog config
  template: >
    src=elastic.conf.j2
    dest=/etc/rsyslog.d/51-elastic.conf
    owner=root
    group=root
    mode=0644

- name: Reload Systemd for Rsyslog
  sudo: yes
  command: systemctl daemon-reload

- name: Restart Rsyslog
  service: name=rsyslog state=restarted

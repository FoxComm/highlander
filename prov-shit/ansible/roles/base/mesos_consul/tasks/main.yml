---

- name: Download mesos-consul release
  get_url: url={{mesos_consul_url}} dest={{home}}/{{mesos_consul_file}}

- name: Unarchive mesos-consul release
  unarchive: src="{{home}}/{{mesos_consul_file}}" dest="{{home}}" copy=no
  become: true

- name: Copy Mesos Consul build
  command: mv {{home}}/{{mesos_consul_dir}}/mesos-consul /usr/local/bin/mesos-consul
  become: true

- name: Make Mesos Consul Executable
  command: chmod +x /usr/local/bin/mesos-consul
  become: true

- name: Remove unarchive subdirectory
  file: path={{home}}/{{mesos_consul_dir}} state=absent
  become: true

- name: Remove release archive
  file: path={{home}}/{{mesos_consul_file}} state=absent
  become: true

- name: Copy Service File
  template: src=mesos_consul.service dest="{{dest_services}}/mesos_consul.service"
  become: true

- name: Copy Execution File
  template: src=run_mesos_consul.sh dest=/usr/local/bin/run_mesos_consul.sh mode="u+x,g+x,o+x"
  become: true

- name: Reload Systemd for Mesos Consul
  command: systemctl daemon-reload
  become: true

- name: Restart Mesos Consul
  service: name=mesos_consul state=restarted enabled=yes
  become: true

- name: Copy Consul Service File
  template: src=mesos_consul.json dest="/etc/consul.d/mesos_consul.json"
  become: true

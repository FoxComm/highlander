---

- name: Copy Mesos Master Run Script
  template: src=run_mesos_master.sh dest=/usr/local/bin/run_mesos_master.sh mode="u+x,g+x,o+x"
  become: true

- name: Get Marathon
  get_url: url=http://downloads.mesosphere.com/marathon/v1.1.1/marathon-1.1.1.tgz dest=/usr/local/
  become: true

- name: Unarchive Marathon
  unarchive: src=/usr/local/marathon-1.1.1.tgz dest=/usr/local/ copy=no
  become: true

- name: Install Mesos Master Service Entry
  become: true
  template:
    src: mesos_master.service
    dest: "{{dest_services}}/mesos_master.service"

- name: Install Marathon Service Entry
  become: true
  template:
    src: marathon.service
    dest: "{{dest_services}}/marathon.service"

- name: Reload Systemd for Mesos Master
  become: true
  command: systemctl daemon-reload

- name: Restart Mesos Master
  service: name=mesos_master state=restarted enabled=true
  become: true

- name: Restart Marathon
  service: name=marathon state=restarted enabled=true
  become: true

- name: Copy Mesos Healthcheck script
  copy: src=mesos_master_check.sh dest=/usr/local/bin/mesos_master_check.sh mode="u=rwx,g=rwx,o=rx"
  become: true

- name: Copy Consul Mesos Master Service File
  template: src=mesos_master.json dest="/etc/consul.d/mesos_master.json"
  become: true

- name: Copy Consul Marathon Service File
  template: src=marathon.json dest="/etc/consul.d/marathon.json"
  become: true

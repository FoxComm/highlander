---

- name: Copy Mesos Worker Run Script
  template: src=run_mesos_worker.sh dest=/usr/local/bin/run_mesos_worker.sh mode="u+x,g+x,o+x"
  pause: seconds=5

- name: Setup Mesos Data Dir
  file: path=/var/lib/sandbox state=directory
  pause: seconds=5

- name: Install Mesos Worker Service Entry
  pause: seconds=5
  template:
    src: mesos_worker.service
    dest: "{{dest_services}}/mesos_worker.service"

- name: Reload Systemd for Mesos Worker
  pause: seconds=5
  command: systemctl daemon-reload

- name: Restart Mesos Worker
  service: name=mesos_worker state=restarted enabled=true
  pause: seconds=5

- name: Make Certs Directory
  file: path=/certs state=directory mode="600"
  pause: seconds=5

- name: Copy Cert
  copy: src="{{role_path}}/../secret_keys/files/certs/{{cert_path}}/frontend/domain.crt" dest=/certs/domain.crt mode="600"
  pause: seconds=5

- name: Copy Key
  copy: src="{{role_path}}/../secret_keys/files/certs/{{cert_path}}/frontend/domain.key" dest=/certs/domain.key mode="600"
  pause: seconds=5

- name: Copy Consul Mesos Worker Service File
  template: src=mesos_worker.json dest="/etc/consul.d/mesos_worker.json"
  pause: seconds=5

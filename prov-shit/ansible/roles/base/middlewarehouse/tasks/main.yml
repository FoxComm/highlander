---

- name: Create middlewarehouse Directory
  file: path={{middlewarehouse_dir}} state=directory owner="{{user}}"
  sudo: true

- name: Copy Binary
  copy: src={{middlewarehouse_bin_src}} dest={{middlewarehouse_bin}} mode="u+x,g+x,o+x"
  sudo: true

- name: Synchronize middlewarehouse Sql
  synchronize: src="{{middlewarehouse_src}}/sql" dest="{{middlewarehouse_dir}}" delete=yes recursive=yes
  sudo: true

- name: Create empty .env file
  file: path="{{middlewarehouse_dir}}/.env.{{middlewarehouse_env}}" state=touch

- name: Copy Service
  template: src=middlewarehouse.service dest="{{dest_services}}/middlewarehouse.service"
  sudo: true

- name: Reload Systemd for middlewarehouse
  sudo: yes
  command: systemctl daemon-reload

- name: Restart middlewarehouse
  service: name=middlewarehouse state=restarted enabled=yes
  sudo: true

- name: Copy Consul Service File
  template: src=middlewarehouse.json dest="/etc/consul.d/middlewarehouse.json"
  sudo: true
  notify: reload consul

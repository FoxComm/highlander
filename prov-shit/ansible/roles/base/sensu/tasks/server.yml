---

  - name: Create Api Config
    template: src=api.json dest={{ sensu_config_path }}

  - name: Start Sensu Server
    service: name=sensu-server state=started enabled=yes

  - name: Start Sensu Api
    service: name=sensu-api state=started enabled=yes

  - name: Install Uchiwa
    apt: name=uchiwa state=latest

  - name: Create Uchiwa Config
    template: src=uchiwa.json dest=/etc/sensu

  - name: Start Uchiwa Service
    service: name=uchiwa state=started enabled=yes

  - name: Deploy Definitions to the master
    template: src={{ item }} dest="{{ sensu_config_path }}/{{ item | basename }}"
    with_fileglob: "{{ sensu_definitions }}/*"

  - name: Restart Sensu Core
    command: echo "restart sensu core services"
    notify:
      - restart sensu-server
      - restart sensu-api
      - restart uchiwa

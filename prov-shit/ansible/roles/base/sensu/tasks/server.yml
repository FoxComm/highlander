---

  - name: Create Redis Config
    template: src=redis.json dest={{ sensu_config_path }}
    become: true

  - name: Create Transport Config
    template: src=transport.json dest={{ sensu_config_path }}
    become: true

  - name: Create Api Config
    template: src=api.json dest={{ sensu_config_path }}
    notify: restart sensu-api

  - name: Start Sensu Server
    service: name=sensu-server state=started enabled=yes

  - name: Start Sensu Api
    service: name=sensu-api state=started enabled=yes

  - name: Install Uchiwa
    apt: name=uchiwa state=latest

  - name: Create Uchiwa Config
    template: src=uchiwa.json dest=/etc/sensu
    notify: restart uchiwa

  - name: Start Uchiwa Service
    service: name=uchiwa state=started enabled=yes

  - name: Deploy Definitions to the master
    template: src={{ item }} dest="{{ sensu_config_path }}/{{ item | basename }}"
    with_fileglob: "{{ sensu_definitions }}/*"
    notify:
      - restart sensu-server
      - restart sensu-api

---
# Deploy client configs for Sensu

  - name: Check Sensu config directory
    file: dest="{{ sensu_config_path }}/conf.d" state=directory recurse=true

  - name: Create Sensu client RabbitMQ transport config
    template: dest="{{ sensu_config_path }}/conf.d/rabbitmq.json" src=rabbitmq.json
    when: sensu_transport == "rabbitmq"

  - name: Create Sensu client Redis transport config
    template: dest="{{ sensu_config_path }}/conf.d/redis.json" src=sensu-redis.json
    when: sensu_transport == "redis"

  - name: Create Sensu client transport config
    template: dest="{{ sensu_config_path }}/conf.d/transport.json" src=transport.json
    notify: restart sensu-client service

  - name: Create Sensu client main config
    template: dest="{{ sensu_config_path }}/conf.d/client.json" src=client.json
    notify: restart sensu-client service

  - name: Start Sensu client
    service: name=sensu-client state=started enabled=yes

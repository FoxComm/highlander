---
# tasks file for sensu

# Install and configure Sensu Core with all Services

# REDIS BIND
# RESTART REDIS & RABBIT
# SLACK SCRIPT!

  - name: Install build tools
    apt: name=build-essential state=present

  - name: Add Sensu Core repo key
    apt_key: url="{{ sensu_core_repo_key }}" state=present

  - name: Add Sensu Core repo
    apt_repository: repo="{{ sensu_core_repo }}" state=present update_cache=true

  - name: Install Sensu Core
    apt: name=sensu state=present

  - include: redis.yml
    tags: redis
    when: deploy_redis and sensu_master

  - include: ssl.yml
    tags: ssl

  - include: rabbit.yml
    tags: rabbitmq
    when: deploy_rabbitmq and sensu_master

  - include: server.yml
    tags: server
    when: sensu_master

  - include: dashboard.yml
    tags: dashboard
    when: sensu_include_dashboard

  - include: client.yml
    tags: client

  - include: plugins.yml
    tags: plugins

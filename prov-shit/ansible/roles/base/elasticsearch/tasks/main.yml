---

- name: Get ElasticSearch 2.0
  get_url: url=https://download.elastic.co/elasticsearch/elasticsearch/{{es_zip}} dest={{home}}/{{es_zip}}
  pause: seconds=5

- name: Unzip ElasticSearch
  unarchive: src={{home}}/{{es_zip}} dest={{usr_local}} copy=no
  pause: seconds=5

- name: Copy Run Script
  template: src=run_elasticsearch.sh dest={{usr_local}}
  pause: seconds=5

- name: Copy ElasticSearch service
  template: src=elasticsearch.service dest={{dest_services}}/
  pause: seconds=5

- name: Setting Up Admin User Group
  group: name=admin state=present
  pause: seconds=5

- name: Setting Up Elasticsearch User
  user: name=elasticsearch groups=admin
  pause: seconds=5

- name: Create Elasticsearch subdirectories
  file: path={{es_path}}/{{item}} owner=elasticsearch state=directory mode="u=rwx,g=rwx,o=r"
  pause: seconds=5
  with_items:
    - data
    - logs
    - plugins
    - config/scripts

- name: Copy Elasticsearch Config
  template: src=elasticsearch.yml dest={{es_path}}/config/elasticsearch.yml
  pause: seconds=5

- name: Reload Systemd for Elastic Search
  pause: seconds=5
  command: systemctl daemon-reload

- name: Setup Service
  service: name=elasticsearch state=restarted enabled=yes
  pause: seconds=5

- name: Copy Consul Service File
  template: src=elastic.json dest="/etc/consul.d/elastic.json"
  pause: seconds=5

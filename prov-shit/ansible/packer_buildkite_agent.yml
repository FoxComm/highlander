---

- name: Pack Buildkite Agent image
  hosts: all
  tags:
    - packer
  vars:
    user: '{{ansible_ssh_user}}'
    packing: true
  gather_facts: no
  pre_tasks:
    - name: Update Apt Cache
      raw: sudo apt-get update
    - name: Install Python 2 and Boto
      raw: sudo apt-get -y install python2.7 python-boto
    - name: Gather Facts
      setup:
  post_tasks:
    - name: Take a nap for a while
      pause: seconds=5

  roles:
    - { role: base/common }
    - { role: base/ssh_keys }
    - { role: base/docker }
    - { role: base/docker_clean, sudo: true }
    - { role: base/scala }
    - { role: base/clojure }
    - { role: base/node, sudo: true }
    - { role: base/builder, sudo: true }
    - { role: test/db }
    - { role: test/selenium }
    - { role: dev/ssh_gce }

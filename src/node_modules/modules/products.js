/* @flow */

import _ from 'lodash';
import { createReducer } from 'redux-act';
import createAsyncActions from './async-utils';

export type Product = {
  id: number;
  name: string;
  imageUrl: string;
  price: string;
  categories: Array<number>;
}

export const mockedData : Array<Product> = [
  {
    id: 1,
    name: 'Donkey',
    imageUrl: 'https://s3-us-west-2.amazonaws.com/fc-firebird-public/images/product/Granger_Three_Quarter.jpg',
    price: '55$',
    categories: [2],
  },
  {
    id: 2,
    name: 'Shark',
    imageUrl: 'https://s3-us-west-2.amazonaws.com/fc-firebird-public/images/product/Festival_Three_Quarter.jpg',
    price: '20$',
    categories: [2, 3],
  },
  {
    id: 3,
    name: 'Sharkling',
    imageUrl: 'https://s3-us-west-2.amazonaws.com/fc-firebird-public/images/product/Gold_Blue_Three_Quarter.jpg',
    price: '30$',
    categories: [3],
  },
  {
    id: 4,
    name: 'Duck',
    imageUrl: 'https://s3-us-west-2.amazonaws.com/fc-firebird-public/images/product/Emma_Top_Front.jpg',
    price: '40$',
    categories: [3, 4],
  },
  {
    id: 5,
    name: 'Duckling',
    imageUrl: 'https://s3-us-west-2.amazonaws.com/fc-firebird-public/images/product/Marley_Top_Front.jpg',
    price: '100$',
    categories: [4],
  },
  {
    id: 6,
    name: 'Chicken',
    imageUrl: 'https://s3-us-west-2.amazonaws.com/fc-firebird-public/images/product/Round_Readers_Top_Front.jpg',
    price: '60$',
    categories: [4, 2],
  },
  {
    id: 7,
    name: 'Fox',
    imageUrl: 'https://s3-us-west-2.amazonaws.com/fc-firebird-public/images/product/Quay_Side.jpg',
    price: '87$',
    categories: [4, 2, 3],
  },
];

function apiCall(categoryId: ?number): Promise {
  let result = mockedData;
  if (categoryId != void 0) {
    result = _.filter(mockedData, (item) => _.includes(item.categories, categoryId));
  }
  return Promise.resolve(result);
}

const {fetch, ...actions} = createAsyncActions('products', apiCall);

const reducer = createReducer({
  [actions.fetchSucceeded]: (state, payload) => {
    return {
      ...state,
      list: payload,
    };
  },
}, {list: []});

export {
  reducer as default,
  fetch,
};
